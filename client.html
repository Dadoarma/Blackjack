<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ô†Ô∏è Blackjack Premium ‚ô•Ô∏è</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --casino-green: #0a5c36;
            --casino-dark: #0a291a;
            --casino-gold: #ffd700;
            --casino-gold-light: #fff8dc;
            --casino-red: #c62828;
            --casino-blue: #1565c0;
            --card-white: #ffffff;
            --card-shadow: rgba(0, 0, 0, 0.3);
            --table-felt: #2e7d32;
            --chip-red: #d32f2f;
            --chip-blue: #1976d2;
            --chip-black: #212121;
            --chip-green: #388e3c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--casino-dark), #1a472a);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .background-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(198, 40, 40, 0.1) 0%, transparent 50%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 30px 0;
            position: relative;
        }

        .header h1 {
            font-size: 4rem;
            background: linear-gradient(45deg, var(--casino-gold), #ffed4e, var(--casino-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
            font-family: 'Georgia', serif;
            letter-spacing: 3px;
        }

        .subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
        }

        /* Lobby Styles */
        .lobby {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin: 0 auto;
            max-width: 500px;
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .lobby h2 {
            color: var(--casino-gold);
            margin-bottom: 30px;
            text-align: center;
            font-size: 2rem;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }

        .input-field {
            width: 100%;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--casino-gold);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2);
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--casino-green), #4caf50);
            color: white;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--casino-blue), #2196f3);
            color: white;
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(33, 150, 243, 0.6);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--casino-red), #f44336);
            color: white;
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }

        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(244, 67, 54, 0.6);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .buttons-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }

        .buttons-group.horizontal {
            flex-direction: row;
        }

        .buttons-group.vertical {
            flex-direction: column;
        }

        .info-text {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 20px;
            font-size: 0.9rem;
        }

        /* Game Table */
        .game-table {
            display: none;
            position: relative;
            background: var(--table-felt);
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5);
            border: 8px solid var(--casino-gold);
            min-height: 700px;
            overflow: hidden;
        }

        .game-table.active {
            display: block;
            animation: tableAppear 0.5s ease-out;
        }

        @keyframes tableAppear {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
        }

        .table-code {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--casino-gold);
            border: 2px solid var(--casino-gold);
        }

        .table-info {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .chip-count {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chip-count i {
            color: var(--casino-gold);
        }

        /* Game Areas */
        .game-area {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
        }

        .players-panel {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }

        .players-panel h3 {
            color: var(--casino-gold);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .player-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .player-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-item.active {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid var(--casino-gold);
            transform: scale(1.02);
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .player-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .player-details h4 {
            color: white;
            margin-bottom: 4px;
        }

        .player-chips {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .player-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-playing { background: var(--casino-green); }
        .status-standing { background: var(--casino-blue); }
        .status-bust { background: var(--casino-red); }
        .status-blackjack { background: linear-gradient(135deg, #9c27b0, #673ab7); }
        .status-waiting { background: #ff9800; }

        /* Game Board */
        .game-board {
            display: flex;
            flex-direction: column;
            gap: 40px;
        }

        .dealer-area, .player-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            position: relative;
        }

        .area-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .area-header h3 {
            color: var(--casino-gold);
            font-size: 1.5rem;
        }

        .hand-value {
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .cards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            min-height: 140px;
            padding: 20px;
            justify-content: center;
            align-items: center;
        }

        /* Cards */
        .card {
            width: 100px;
            height: 140px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 15px;
            position: relative;
            box-shadow: 0 8px 16px var(--card-shadow);
            transition: all 0.3s ease;
            animation: dealCard 0.5s ease-out;
        }

        @keyframes dealCard {
            0% { transform: translateY(-50px) rotate(-10deg); opacity: 0; }
            100% { transform: translateY(0) rotate(0); opacity: 1; }
        }

        .card:hover {
            transform: translateY(-10px) rotate(2deg);
        }

        .card.red {
            background: linear-gradient(135deg, #ffffff, #f5f5f5);
            color: #d32f2f;
        }

        .card.black {
            background: linear-gradient(135deg, #ffffff, #f5f5f5);
            color: #212121;
        }

        .card.hidden {
            background: linear-gradient(45deg, #1a237e, #283593);
            color: transparent;
        }

        .card.hidden::before {
            content: '‚ô†';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 3rem;
            opacity: 0.8;
        }

        .card-corner {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .card-corner.top {
            align-self: flex-start;
        }

        .card-corner.bottom {
            align-self: flex-end;
            transform: rotate(180deg);
        }

        .card-center {
            font-size: 3rem;
            align-self: center;
            margin: auto 0;
        }

        /* Game Controls */
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .control-btn {
            min-width: 150px;
            padding: 18px 30px;
            font-size: 1.1rem;
        }

        /* Results */
        .result-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px 60px;
            border-radius: 20px;
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            z-index: 100;
            animation: resultPop 0.5s ease-out;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: none;
        }

        @keyframes resultPop {
            0% { transform: translate(-50%, -50%) scale(0); }
            80% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .result-win {
            background: linear-gradient(135deg, var(--casino-green), #4caf50);
            color: var(--casino-gold);
            border: 5px solid var(--casino-gold);
        }

        .result-lose {
            background: linear-gradient(135deg, var(--casino-red), #f44336);
            color: white;
            border: 5px solid #ff9800;
        }

        .result-push {
            background: linear-gradient(135deg, #1565c0, #2196f3);
            color: white;
            border: 5px solid #4fc3f7;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 10px;
            border-left: 4px solid var(--casino-gold);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .game-area {
                grid-template-columns: 1fr;
            }
            
            .players-panel {
                max-height: 200px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .game-table {
                padding: 15px;
            }
            
            .table-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .game-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .card {
                width: 80px;
                height: 112px;
            }
        }
    </style>
</head>
<body>
    <div class="background-effects"></div>
    
    <div class="container">
        <div class="header">
            <h1>‚ô†Ô∏è BLACKJACK PREMIUM ‚ô•Ô∏è</h1>
            <p class="subtitle">Experience the thrill of Las Vegas from your browser</p>
        </div>

        <!-- Lobby Screen -->
        <div id="lobby" class="lobby">
            <h2><i class="fas fa-dice"></i> Join the Game</h2>
            
            <div class="input-group">
                <label for="playerName"><i class="fas fa-user"></i> Your Name</label>
                <input type="text" 
                       id="playerName" 
                       class="input-field" 
                       placeholder="Enter your name"
                       maxlength="12"
                       value="Player">
            </div>
            
            <div class="buttons-group vertical">
                <button class="btn btn-primary" onclick="createTable()">
                    <i class="fas fa-plus-circle"></i> Create New Table
                </button>
                
                <div style="text-align: center; margin: 20px 0;">
                    <span style="color: rgba(255,255,255,0.7);">‚Äî OR ‚Äî</span>
                </div>
                
                <div class="input-group">
                    <label for="tableCode"><i class="fas fa-hashtag"></i> Table Code</label>
                    <input type="text" 
                           id="tableCode" 
                           class="input-field" 
                           placeholder="Enter 6-character code"
                           maxlength="6"
                           style="text-transform: uppercase">
                </div>
                
                <button class="btn btn-secondary" onclick="joinTable()">
                    <i class="fas fa-sign-in-alt"></i> Join Existing Table
                </button>
            </div>
            
            <p class="info-text">
                <i class="fas fa-info-circle"></i> 
                Up to 5 players per table. Share your table code with friends to play together!
            </p>
        </div>

        <!-- Game Table -->
        <div id="gameTable" class="game-table">
            <div class="table-header">
                <div class="table-code" id="tableCodeDisplay">
                    <i class="fas fa-table"></i> Table: <span id="codeValue">------</span>
                </div>
                
                <div class="table-info">
                    <div class="chip-count">
                        <i class="fas fa-coins"></i>
                        <span id="playerChips">1,000</span> chips
                    </div>
                    <button class="btn btn-danger" onclick="leaveTable()">
                        <i class="fas fa-sign-out-alt"></i> Leave
                    </button>
                </div>
            </div>

            <div class="game-area">
                <!-- Players Panel -->
                <div class="players-panel">
                    <h3><i class="fas fa-users"></i> Players <span id="playersCount">(0)</span></h3>
                    <div id="playersList" class="player-list">
                        <!-- Players will be dynamically added here -->
                    </div>
                </div>

                <!-- Game Board -->
                <div class="game-board">
                    <!-- Dealer Area -->
                    <div class="dealer-area">
                        <div class="area-header">
                            <h3><i class="fas fa-user-tie"></i> Dealer</h3>
                            <div class="hand-value" id="dealerValue">Value: ?</div>
                        </div>
                        <div id="dealerCards" class="cards-container">
                            <!-- Dealer cards will appear here -->
                        </div>
                    </div>

                    <!-- Player Area -->
                    <div class="player-area">
                        <div class="area-header">
                            <h3><i class="fas fa-user"></i> Your Hand</h3>
                            <div class="hand-value" id="playerValue">Value: 0</div>
                        </div>
                        <div id="playerCards" class="cards-container">
                            <!-- Player cards will appear here -->
                        </div>
                        
                        <!-- Game Controls -->
                        <div class="game-controls">
                            <button id="hitBtn" class="btn btn-primary control-btn" onclick="sendAction('HIT')">
                                <i class="fas fa-plus"></i> HIT
                            </button>
                            <button id="standBtn" class="btn btn-secondary control-btn" onclick="sendAction('STAND')">
                                <i class="fas fa-hand-paper"></i> STAND
                            </button>
                            <button id="doubleBtn" class="btn btn-primary control-btn" onclick="sendAction('DOUBLE')" disabled>
                                <i class="fas fa-times-circle"></i> DOUBLE
                            </button>
                            <button id="againBtn" class="btn btn-danger control-btn" onclick="sendAction('YES')" disabled>
                                <i class="fas fa-redo"></i> PLAY AGAIN
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Result Message -->
            <div id="resultMessage" class="result-message"></div>
        </div>
    </div>

    <script>
        // Game state
        let ws = null;
        let playerId = null;
        let playerName = '';
        let tableCode = '';
        let chips = 1000;
        let currentBet = 0;
        let isMyTurn = false;
        let gameActive = false;
        
        // DOM Elements
        const elements = {
            lobby: document.getElementById('lobby'),
            gameTable: document.getElementById('gameTable'),
            playerNameInput: document.getElementById('playerName'),
            tableCodeInput: document.getElementById('tableCode'),
            tableCodeDisplay: document.getElementById('codeValue'),
            playersList: document.getElementById('playersList'),
            playersCount: document.getElementById('playersCount'),
            playerChips: document.getElementById('playerChips'),
            dealerCards: document.getElementById('dealerCards'),
            playerCards: document.getElementById('playerCards'),
            dealerValue: document.getElementById('dealerValue'),
            playerValue: document.getElementById('playerValue'),
            resultMessage: document.getElementById('resultMessage'),
            hitBtn: document.getElementById('hitBtn'),
            standBtn: document.getElementById('standBtn'),
            doubleBtn: document.getElementById('doubleBtn'),
            againBtn: document.getElementById('againBtn')
        };
        
        // Create a new table
        function createTable() {
            playerName = elements.playerNameInput.value.trim() || 'Player';
            if (!playerName) {
                showNotification('Please enter your name', 'error');
                return;
            }
            
            connectWebSocket(`CREATE ${playerName}`);
        }
        
        // Join an existing table
        function joinTable() {
            playerName = elements.playerNameInput.value.trim() || 'Player';
            const code = elements.tableCodeInput.value.trim().toUpperCase();
            
            if (!playerName) {
                showNotification('Please enter your name', 'error');
                return;
            }
            
            if (!code || code.length !== 6) {
                showNotification('Please enter a valid 6-character table code', 'error');
                return;
            }
            
            connectWebSocket(`JOIN ${code} ${playerName}`);
        }
        
        // Connect to WebSocket server
        function connectWebSocket(message) {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const host = window.location.host;
            const wsUrl = `${protocol}//${host}`;
            
            ws = new WebSocket(wsUrl);
            
            ws.onopen = () => {
                console.log('Connected to server');
                ws.send(message);
            };
            
            ws.onmessage = (event) => {
                handleServerMessage(event.data);
            };
            
            ws.onclose = () => {
                console.log('Disconnected from server');
                if (gameActive) {
                    showNotification('Disconnected from server', 'error');
                    setTimeout(() => leaveTable(), 2000);
                }
            };
            
            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
                showNotification('Connection error. Please try again.', 'error');
            };
        }
        
        // Handle messages from server
        function handleServerMessage(data) {
            console.log('Server message:', data);
            
            const parts = data.split(' ');
            const command = parts[0];
            const args = parts.slice(1).join(' ');
            
            switch(command) {
                case 'TABLE_CREATED':
                    handleTableCreated(args);
                    break;
                    
                case 'TABLE_JOINED':
                    handleTableJoined(args);
                    break;
                    
                case 'TABLE_NOT_FOUND':
                    showNotification('Table not found. Please check the code.', 'error');
                    break;
                    
                case 'TABLE_FULL':
                    showNotification('Table is full (max 5 players)', 'error');
                    break;
                    
                case 'GAME_IN_PROGRESS':
                    showNotification('Game is in progress. Please wait for the next round.', 'info');
                    break;
                    
                case 'YOUR_ID':
                    playerId = args;
                    break;
                    
                case 'PLAYER_LIST':
                    updatePlayerList(JSON.parse(args));
                    break;
                    
                case 'GAME_START':
                    startGame();
                    break;
                    
                case 'YOUR_TURN':
                    enablePlayerTurn();
                    break;
                    
                case 'DEALER_RESET':
                    resetTable();
                    break;
                    
                case 'CARDS':
                    updatePlayerCards(args);
                    break;
                    
                case 'DEALER_INIT':
                    updateDealerInitial(args.split(' '));
                    break;
                    
                case 'DEALER_REVEAL':
                    revealDealerCard();
                    break;
                    
                case 'DEALER_CARD':
                    addDealerCard(args);
                    break;
                    
                case 'PLAYER_ACTION':
                    const [actionPlayerId, action] = args.split(':');
                    showPlayerAction(actionPlayerId, action);
                    break;
                    
                case 'RESULT':
                    showGameResult(args);
                    break;
                    
                case 'PLAY_AGAIN?':
                    enablePlayAgain();
                    break;
                    
                case 'PLAY_AGAIN_LOCK':
                    lockPlayAgain();
                    break;
                    
                case 'CHIP_UPDATE':
                    updateChips(parseInt(args));
                    break;
                    
                case 'ERROR':
                    showNotification(args, 'error');
                    break;
            }
        }
        
        // Handle table creation
        function handleTableCreated(code) {
            tableCode = code;
            showGameScreen();
            showNotification(`Table created! Code: ${code}`, 'success');
        }
        
        // Handle joining table
        function handleTableJoined(code) {
            tableCode = code;
            showGameScreen();
            showNotification(`Joined table ${code}`, 'success');
        }
        
        // Show game screen
        function showGameScreen() {
            elements.lobby.style.display = 'none';
            elements.gameTable.classList.add('active');
            elements.tableCodeDisplay.textContent = tableCode;
            gameActive = true;
        }
        
        // Leave table
        function leaveTable() {
            if (ws) {
                ws.close();
            }
            
            elements.gameTable.classList.remove('active');
            elements.lobby.style.display = 'block';
            resetGameState();
            showNotification('Left the table', 'info');
        }
        
        // Reset game state
        function resetGameState() {
            playerId = null;
            tableCode = '';
            chips = 1000;
            currentBet = 0;
            isMyTurn = false;
            gameActive = false;
            
            elements.playersList.innerHTML = '';
            elements.dealerCards.innerHTML = '';
            elements.playerCards.innerHTML = '';
            elements.dealerValue.textContent = 'Value: ?';
            elements.playerValue.textContent = 'Value: 0';
            elements.resultMessage.style.display = 'none';
            
            disableAllButtons();
        }
        
        // Update player list
        function updatePlayerList(players) {
            elements.playersList.innerHTML = '';
            let playerCount = 0;
            
            for (const [id, player] of Object.entries(players)) {
                playerCount++;
                const playerElement = document.createElement('div');
                playerElement.className = `player-item ${id === playerId ? 'active' : ''}`;
                
                playerElement.innerHTML = `
                    <div class="player-info">
                        <div class="player-avatar">
                            ${player.name.charAt(0).toUpperCase()}
                        </div>
                        <div class="player-details">
                            <h4>${player.name} ${id === playerId ? '(You)' : ''}</h4>
                            <div class="player-chips">${player.chips} chips</div>
                        </div>
                    </div>
                    <div class="player-status status-${player.status}">
                        ${getStatusText(player.status)}
                    </div>
                `;
                
                elements.playersList.appendChild(playerElement);
            }
            
            elements.playersCount.textContent = `(${playerCount}/5)`;
        }
        
        // Get status text
        function getStatusText(status) {
            const statusMap = {
                'waiting': 'Waiting',
                'playing': 'Playing',
                'standing': 'Standing',
                'bust': 'Bust!',
                'blackjack': 'Blackjack!'
            };
            return statusMap[status] || status;
        }
        
        // Start new game
        function startGame() {
            resetTable();
            disableAllButtons();
            showNotification('New round starting!', 'info');
        }
        
        // Reset table
        function resetTable() {
            elements.dealerCards.innerHTML = '';
            elements.playerCards.innerHTML = '';
            elements.dealerValue.textContent = 'Value: ?';
            elements.playerValue.textContent = 'Value: 0';
            elements.resultMessage.style.display = 'none';
        }
        
        // Update player cards
        async function updatePlayerCards(cardsStr) {
            const cards = cardsStr.split(',');
            
            // Clear existing cards except the first two (if any)
            if (elements.playerCards.children.length === 0) {
                for (const card of cards) {
                    await addCardToContainer(elements.playerCards, card, false);
                }
            } else {
                // Only add new cards
                for (const card of cards.slice(elements.playerCards.children.length)) {
                    await addCardToContainer(elements.playerCards, card, false);
                }
            }
            
            updateHandValue(elements.playerValue, cards);
        }
        
        // Update dealer initial cards
        async function updateDealerInitial(cards) {
            elements.dealerCards.innerHTML = '';
            
            // First card hidden
            await addCardToContainer(elements.dealerCards, 'üÇ†', true);
            
            // Second card visible
            if (cards[1]) {
                await addCardToContainer(elements.dealerCards, cards[1], false);
            }
            
            // Show value of visible card
            const visibleValue = calculateHandValue([cards[1]]);
            elements.dealerValue.textContent = `Showing: ${visibleValue}`;
        }
        
        // Reveal dealer's hidden card
        async function revealDealerCard() {
            const hiddenCard = elements.dealerCards.children[0];
            if (hiddenCard) {
                hiddenCard.classList.remove('hidden');
                
                // Replace placeholder with actual card
                const dealerCard = dealerHand && dealerHand[0] ? dealerHand[0] : 'A‚ô†';
                hiddenCard.innerHTML = createCardHTML(dealerCard);
                
                const suit = dealerCard.slice(-1);
                hiddenCard.classList.add(['‚ô•','‚ô¶'].includes(suit) ? 'red' : 'black');
                
                await sleep(500);
            }
        }
        
        // Add dealer card
        async function addDealerCard(card) {
            await addCardToContainer(elements.dealerCards, card, false);
            
            // Update dealer hand value
            const dealerCards = Array.from(elements.dealerCards.children)
                .filter(c => !c.classList.contains('hidden'))
                .map(c => {
                    const cardText = c.textContent || '';
                    return cardText.includes('‚ô†') ? 'A‚ô†' : cardText;
                });
            
            if (dealerHand) {
                dealerHand.push(card);
            }
            
            updateHandValue(elements.dealerValue, dealerHand || [card]);
        }
        
        // Add card to container with animation
        async function addCardToContainer(container, card, hidden) {
            return new Promise(resolve => {
                const cardElement = document.createElement('div');
                cardElement.className = `card ${hidden ? 'hidden' : ''}`;
                
                if (!hidden) {
                    const suit = card.slice(-1);
                    cardElement.classList.add(['‚ô•','‚ô¶'].includes(suit) ? 'red' : 'black');
                    cardElement.innerHTML = createCardHTML(card);
                } else {
                    cardElement.textContent = 'üÇ†';
                }
                
                container.appendChild(cardElement);
                
                // Trigger animation
                setTimeout(() => {
                    cardElement.style.animation = 'dealCard 0.5s ease-out';
                    setTimeout(resolve, 500);
                }, 50);
            });
        }
        
        // Create card HTML
        function createCardHTML(card) {
            if (card === 'üÇ†') {
                return '<div class="card-corner top">üÇ†</div><div class="card-center">üÇ†</div><div class="card-corner bottom">üÇ†</div>';
            }
            
            const value = card.slice(0, -1);
            const suit = card.slice(-1);
            
            return `
                <div class="card-corner top">${value}<br>${suit}</div>
                <div class="card-center">${suit}</div>
                <div class="card-corner bottom">${value}<br>${suit}</div>
            `;
        }
        
        // Update hand value display
        function updateHandValue(element, cards) {
            const value = calculateHandValue(cards);
            let status = '';
            
            if (value > 21) {
                status = ' - BUST!';
            } else if (value === 21 && cards.length === 2) {
                status = ' - BLACKJACK!';
            } else if (value === 21) {
                status = ' - 21!';
            }
            
            element.textContent = `Value: ${value}${status}`;
            return value;
        }
        
        // Calculate hand value
        function calculateHandValue(cards) {
            if (!cards || cards.length === 0) return 0;
            
            let value = 0;
            let aces = 0;
            
            for (const card of cards) {
                if (card === 'üÇ†') continue;
                
                const cardValue = card.slice(0, -1);
                if (cardValue === 'A') {
                    value += 11;
                    aces++;
                } else if (['J','Q','K'].includes(cardValue)) {
                    value += 10;
                } else if (cardValue === '10') {
                    value += 10;
                } else {
                    value += parseInt(cardValue);
                }
            }
            
            while (value > 21 && aces > 0) {
                value -= 10;
                aces--;
            }
            
            return value;
        }
        
        // Enable player turn
        function enablePlayerTurn() {
            isMyTurn = true;
            elements.hitBtn.disabled = false;
            elements.standBtn.disabled = false;
            elements.doubleBtn.disabled = (chips < currentBet * 2);
            
            showNotification('Your turn! Hit or Stand?', 'info');
        }
        
        // Send action to server
        function sendAction(action) {
            if (!ws || ws.readyState !== WebSocket.OPEN) return;
            
            ws.send(action);
            
            if (action === 'HIT' || action === 'STAND' || action === 'DOUBLE') {
                isMyTurn = false;
                disableAllButtons();
            }
        }
        
        // Disable all game buttons
        function disableAllButtons() {
            elements.hitBtn.disabled = true;
            elements.standBtn.disabled = true;
            elements.doubleBtn.disabled = true;
            elements.againBtn.disabled = true;
        }
        
        // Show player action
        function showPlayerAction(playerId, action) {
            // This would update the player's status in the list
            // For now, just show a notification
            if (playerId !== playerId) {
                showNotification(`Player ${action.toLowerCase()}ed`, 'info');
            }
        }
        
        // Show game result
        function showGameResult(resultData) {
            const [result, dealerCards] = resultData.split(' DEALER ');
            
            // Update dealer cards
            if (dealerCards) {
                elements.dealerCards.innerHTML = '';
                const cards = dealerCards.split(',');
                cards.forEach(card => {
                    addCardToContainer(elements.dealerCards, card, false);
                });
                updateHandValue(elements.dealerValue, cards);
            }
            
            // Show result message
            elements.resultMessage.textContent = getResultMessage(result);
            elements.resultMessage.className = `result-message result-${result.toLowerCase()}`;
            elements.resultMessage.style.display = 'block';
            
            // Play sound or show effect based on result
            if (result === 'WIN') {
                showNotification('You won! üéâ', 'success');
            } else if (result === 'LOSE') {
                showNotification('You lost üòî', 'error');
            }
            
            // Disable game buttons
            disableAllButtons();
        }
        
        // Get result message
        function getResultMessage(result) {
            switch(result) {
                case 'WIN': return 'YOU WIN! üéâ';
                case 'LOSE': return 'YOU LOSE üòî';
                case 'PUSH': return 'PUSH! Tie ü§ù';
                case 'BLACKJACK': return 'BLACKJACK! üé∞';
                default: return result;
            }
        }
        
        // Enable play again button
        function enablePlayAgain() {
            elements.againBtn.disabled = false;
            showNotification('Play another round?', 'info');
        }
        
        // Lock play again button
        function lockPlayAgain() {
            elements.againBtn.disabled = true;
        }
        
        // Update chips
        function updateChips(newChips) {
            chips = newChips;
            elements.playerChips.textContent = newChips.toLocaleString();
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            let icon = 'fas fa-info-circle';
            if (type === 'error') icon = 'fas fa-exclamation-triangle';
            if (type === 'success') icon = 'fas fa-check-circle';
            
            notification.innerHTML = `<i class="${icon}"></i> ${message}`;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Utility function
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Auto-focus name input
            elements.playerNameInput.focus();
            
            // Enter key to join
            elements.tableCodeInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    joinTable();
                }
            });
        });
    </script>
</body>
</html>